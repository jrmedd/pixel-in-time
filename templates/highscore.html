<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Pocket Racer â€“ High Scores </title>
</head>
<body>
    <div id="good-pocket-wrapper" class="score-table-wrapper">
        <table>
            <caption>Well-sewn pockets</caption>
            <thead>
                <th class="player">Player</th>
                <th class="score">Time</th>
            </thead>
            <tbody id="good-pocket-scores">
        {% for score in high_scores_pass %}
            <tr>
                <td class="player">{{ score['username'] }}</td>
                <td class="score">{{ score['score'] }}s</td>
            </tr>
        {% endfor %}
        </tbody>
        </table>
    </div>
    <div id="bad-pocket-wrapper" class="score-table-wrapper">
        <table>
            <caption>Sub-standard pockets</caption>
            <thead>
                <th class="player">Player</th>
                <th class="score">Time</th>
            </thead>
            <tbody id="bad-pocket-scores">
            {% for score in high_scores_fail %}
            <tr>
                <td class="player">{{ score['username'] }}</td>
                <td class="score">{{ score['score'] }}s</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <script src="{{url_for('static', filename='socket.io.min.js')}}"></script>
    <script>
        const scoreTables = { 'good-pocket': 'high_scores_pass', 'bad-pocket': 'high_scores_fail' };
        const getScore = async () => {
            let scoreRequest = await fetch("https://pocket-racer.xyz/high_scores?json=1")
            let scores = await scoreRequest.json();
            console.log(scores);
            for (let classification in scoreTables) {
                let scoreTableBody = document.getElementById(`${classification}-scores`);
                scoreTableBody.innerHTML = "";
                scores[scoreTables[classification]].forEach(v => {
                    let newScore = document.createElement('tr');
                    let playerCell = document.createElement('td');
                    playerCell.classList.add('player');
                    playerCell.textContent = v['username'];
                    let scoreCell = document.createElement('td');
                    scoreCell.classList.add('score');
                    scoreCell.textContent = `${v['score']}s`;
                    newScore.appendChild(playerCell);
                    newScore.appendChild(scoreCell);
                    scoreTableBody.appendChild(newScore)
                });
            }
        }
        let thirtySecondCheck = setInterval(()=>{getScore()}, 30000);
    </script>
</body>
</html>