<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Pocket Racer â€“ High Scores </title>
</head>
<body>
    <div class="score-table-wrapper">
        <table>
            <caption>Live times</caption>
            <thead>
                <th class="player">Player</th>
                <th class="score">Time</th>
            </thead>
            <tbody id="live-scores">
        {% for score in live_scores %}
            <tr>
                <td class="player">{{ score['username'] }}</td>
                <td class="score">{{ score['score'] }}s</td>
            </tr>
        {% endfor %}
        </tbody>
        </table>
    </div>
    <script src="{{url_for('static', filename='socket.io.min.js')}}"></script>
    <script>
        let incomingScores = io.connect(location.origin + '/scores');
        let sessionid
        incomingScores.on('connect', function () {
            sessionid = this.id;
        });
        let scores;
        incomingScores.on('new-scores', (data) => {
            let scores = data;
            let scoreTableBody = document.getElementById(`live-scores`);
            scoreTableBody.innerHTML = "";
            scores['live-scores'].forEach(v => {
                    let newScore = document.createElement('tr');
                    let playerCell = document.createElement('td');
                    playerCell.classList.add('player');
                    playerCell.textContent = v['username'];
                    let scoreCell = document.createElement('td');
                    scoreCell.classList.add('score');
                    scoreCell.textContent = v['score'];
                    newScore.appendChild(playerCell);
                    newScore.appendChild(scoreCell);
                    scoreTableBody.appendChild(newScore)
                });
            });
    </script>
</body>
</html>